<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>너와농부싶어</title>
    <link rel="icon" href="/image/header/favicon.png" />
    <link rel="shortcut icon" href="/image/header/favicon.png" />
    <link rel="stylesheet" href="/css/common/font.css" />
    <link rel="stylesheet" href="/css/header/header.css" />
    <link rel="stylesheet" href="/css/footer/footer.css" />
    <link rel="stylesheet" href="/css/myPage/sideMenu.css" />
    <link rel="stylesheet" href="/css/myPage/community.css" />
    <link rel="stylesheet" href="/css/myPage/paging.css" />
</head>
<body>
<div th:replace="/header/header.html :: header" class="header"/>
<div id="main">
    <div class="wrap-w" style="padding-bottom: 0">
        <div class="container">
            <div class="contentsWrap">
                <!--메뉴 카텍고리 시작-->
                <div th:replace="/myPage/sidemenu.html :: myPageMenu"></div>
                <!--컨텐츠 시작-->
                <div class="contents">
                    <div class="c-header">
                        <div class="c-title">
                            <div>커뮤니티 활동</div>
                        </div>
                        <div class="content">
                            <!-- 커뮤니티 활동이 없을 경우 -->
                            <div id="c-n"></div>
<!--                            <div id="content-wrap" class="f-column">
                                <div class="n-c-wrap">
                                    앗! 아직 활동내역이 없습니다.<br>
                                    게시글을 등록하고 자유롭게 이야기를 나눠보세요!
                                    <button class="sendPage-btn" th:onclick="">커뮤니티 입장하기</button>
                                </div>
                            </div>-->
                            <!------------------------>
                            <!-- 커뮤니티 활동이 있을 경우 -->
<!--                            <div id="c-w"></div>-->
                            <div id="c-w-wrap" class="f-column" >
                                <!--
                                                                &lt;!&ndash;&ndash;&gt;
                                                                <div class="commu c-link" th:onclick="|javascript:viewDetail(${board.boardId})|">
                                                                    <div class="c-top-wrap">
                                                                        <div class="c-date" th:text="${#temporals.format(board.createdDate, 'yyyy.MM.dd HH:mm')}">
                                                                            2022.11.13 15:00
                                                                        </div>
                                                                        <a href='javascript:void(0);' onclick="removeCheck();" class="c-delete">삭제</a>
                                                                    </div>
                                                                    <div class="c-group">
                                                                        <div class="c-g-title" th:text="${board.boardTitle}">청년! 3박4일 예천에 한번 살아볼까요?</div>
                                                                    </div>
                                                                    <div class="commu-group">
                                                                        <span class="c-count">
                                                                            <svg data-v-bd9f2bcc="" data-v-7d0ae9c8="" width="16" height="16" viewBox="0 0 16 16" fill="black" xmlns="http://www.w3.org/2000/svg" class="mr-4 c-application c-icon" style="fill: rgb(148, 155, 160);"><path data-v-bd9f2bcc="" fill-rule="evenodd" clip-rule="evenodd" d="M13.8766 8C11.3452 12.6334 4.65478 12.6334 2.12331 8C4.65478 3.36658 11.3452 3.36658 13.8766 8ZM14.8923 7.78461C12.0525 2.10504 3.94746 2.10504 1.10767 7.78461C1.03988 7.9202 1.03988 8.07979 1.10767 8.21538C3.94746 13.895 12.0525 13.895 14.8923 8.21538C14.9601 8.07979 14.9601 7.9202 14.8923 7.78461Z"></path><path data-v-bd9f2bcc="" fill-rule="evenodd" clip-rule="evenodd" d="M8 9.5C8.82843 9.5 9.5 8.82843 9.5 8C9.5 7.17157 8.82843 6.5 8 6.5C7.17157 6.5 6.5 7.17157 6.5 8C6.5 8.82843 7.17157 9.5 8 9.5ZM8 10.5C9.38071 10.5 10.5 9.38071 10.5 8C10.5 6.61929 9.38071 5.5 8 5.5C6.61929 5.5 5.5 6.61929 5.5 8C5.5 9.38071 6.61929 10.5 8 10.5Z"></path></svg>
                                                                            <span class="c-text" >0</span>
                                                                        </span>
                                                                        <span class="c-count">
                                                                            <svg data-v-bd9f2bcc="" data-v-7d0ae9c8="" width="16" height="16" viewBox="0 0 16 16" fill="black" xmlns="http://www.w3.org/2000/svg" class="mr-4 c-application c-icon" style="fill: rgb(148, 155, 160);"><path data-v-bd9f2bcc="" fill-rule="evenodd" clip-rule="evenodd" d="M3.69638 13.5299C4.05199 13.1404 4.04399 12.5417 3.67811 12.1619C2.63802 11.0821 2 9.6166 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8C14 11.3137 11.3137 14 8 14H3.26717L3.69638 13.5299ZM1 8C1 9.88557 1.74553 11.597 2.95789 12.8556L1.76434 14.1629C1.47131 14.4838 1.699 15 2.13358 15H8C11.866 15 15 11.866 15 8C15 4.13401 11.866 1 8 1C4.13401 1 1 4.13401 1 8Z"></path><path data-v-bd9f2bcc="" d="M6 8C6 8.41421 5.66421 8.75 5.25 8.75C4.83579 8.75 4.5 8.41421 4.5 8C4.5 7.58579 4.83579 7.25 5.25 7.25C5.66421 7.25 6 7.58579 6 8Z"></path><path data-v-bd9f2bcc="" d="M8.75 8C8.75 8.41421 8.41421 8.75 8 8.75C7.58579 8.75 7.25 8.41421 7.25 8C7.25 7.58579 7.58579 7.25 8 7.25C8.41421 7.25 8.75 7.58579 8.75 8Z"></path><path data-v-bd9f2bcc="" d="M11.5 8C11.5 8.41421 11.1642 8.75 10.75 8.75C10.3358 8.75 10 8.41421 10 8C10 7.58579 10.3358 7.25 10.75 7.25C11.1642 7.25 11.5 7.58579 11.5 8Z"></path></svg>
                                                                            <span class="c-text" th:text="${board.boardViewCount}">0</span>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                &lt;!&ndash;&ndash;&gt;

                                                            </div>-->
                            <!------------------------>
                        </div>

                        <div id="paging" style="margin-bottom: 100px;">
                            <!--                    <ul th:with="start=${(albas.number/maxPage)*maxPage + 1}, end=(${(albas.totalPages == 0) ? 1 : (start + (maxPage - 1) < albas.totalPages ? start + (maxPage - 1) : albas.totalPages)})">-->
                            <!--                        <li class="sidePageNum prev" th:if="${albas.pageable.pageNumber > 0}">-->
                            <!--                            <a th:href="@{/alba/list(page=${((albas.pageable.pageNumber/5)*5) - 1})}" class="page"><svg width="16" height="16" class="sidePageDisabled" viewBox="0 0 16 16" fill="black" xmlns="http://www.w3.org/2000/svg" style="transform:rotate(270deg);" data-v-bd9f2bcc="" data-v-30c80689=""><path fill-rule="evenodd" clip-rule="evenodd" d="M7.64645 4.64645C7.84171 4.45118 8.15829 4.45118 8.35355 4.64645L12.8536 9.14645C13.0488 9.34171 13.0488 9.65829 12.8536 9.85355C12.6583 10.0488 12.3417 10.0488 12.1464 9.85355L8 5.70711L3.85355 9.85355C3.65829 10.0488 3.34171 10.0488 3.14645 9.85355C2.95118 9.65829 2.95118 9.34171 3.14645 9.14645L7.64645 4.64645Z" data-v-bd9f2bcc=""></path></svg></a>-->
                            <!--                        </li>-->
                            <!--                        <th:block  th:each="i: ${#numbers.sequence(start, end)}">-->
                            <!--                            <li>-->
                            <!--                                <a class="page" th:href="@{/alba/list(page=${i - 1})}" th:classappend="${i == albas.pageable.pageNumber + 1} ? 'selectPage' : '' " th:text="${i}">1</a>-->
                            <!--                            </li>-->
                            <!--                        </th:block >-->
                            <!--                        <li class="sidePageNum next" th:if="${end < albas.totalPages}">-->
                            <!--                            <a th:href="@{/alba/list(page=${end})}" class="page"><svg width="16" height="16" viewBox="0 0 16 16" fill="black" xmlns="http://www.w3.org/2000/svg" style="transform:rotate(90deg);" data-v-bd9f2bcc="" data-v-30c80689=""><path fill-rule="evenodd" clip-rule="evenodd" d="M7.64645 4.64645C7.84171 4.45118 8.15829 4.45118 8.35355 4.64645L12.8536 9.14645C13.0488 9.34171 13.0488 9.65829 12.8536 9.85355C12.6583 10.0488 12.3417 10.0488 12.1464 9.85355L8 5.70711L3.85355 9.85355C3.65829 10.0488 3.34171 10.0488 3.14645 9.85355C2.95118 9.65829 2.95118 9.34171 3.14645 9.14645L7.64645 4.64645Z" data-v-bd9f2bcc=""></path></svg></a>-->
                            <!--                        </li>-->
                            <!--                    </ul>-->
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 푸터 -->
<div th:replace="/footer/footer.html :: footer" class="footer"/>
<!-- 알람 모달창 -->
<div class="overlay-l" style="display: none">
    <div id="alam">
        <p>정말 삭제하시겠어요?</p>
        <p>한번 삭제된 게시글은 복구할 수 없습니다.</p>
        <form action="/mypage/community" method="post" id="delete-Board">
            <div id="alam-btn-group">
                <button class="a-ok" id="board-delete-btn">확인</button>
                <button type="button" class="a-no">취소</button>
                <input hidden name="boardIdString" id="boardIdString">
            </div>
        </form>
    </div>
</div>
</body>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
<script src="/js/header/header.js"></script>
<script src="/js/myPage/myPage.js"></script>
<script src="/js/myPage/myPageRest.js"></script>
<script th:inline="javascript">

    $("div.menu-a").removeClass('menu-select');
    $("#community").addClass('menu-select');

    // 글 삭제 모달 알람
    function removeCheck(boardId){
        event.stopImmediatePropagation();
        $("#boardIdString").attr("value", boardId);
        console.log("확인"+boardId);
        // let boardId = this.classList[1];
        $(".overlay-l").show();
    };

    $(".a-no").on("click", function(){
        $(".overlay-l").hide();
    });

    // 글 삭제버튼 클릭
    $("#board-delete-btn").on("click" , function () {
        console.log("확인"+boardId);
        $("#delete-Board").submit();
    })

    //글 삭제 취소버튼 클릭
    $(".a-no").on("click", function(){
        $(".alam-wrap").hide();
        return;
    });

    //상세페이지 이동 함수
    function viewDetail(boardId) {
        console.log("??");
        location.href = "/community/detail?boardId=" + boardId;

    }

    $("#c-w-wrap").on("click", "div.commu", function(){
        let boardId = this.classList[2];
        viewDetail(boardId);
    })
    /*------------------------------------------*/

    let memberId = [[${member.memberId}]];

    globalThis.page = 1;
    $(document).ready(function () {
        myPageService.getBoList({
            page: globalThis.page
        }, getList);

    })

    function showNew(){
        myPageService.getBoList({
            page: globalThis.page
        }, getList);
    }

    function getList(boards){
        console.log(boards);

        let text = "";

        if(boards.content.length == 0){
            text += '<div id="content-wrap" class="f-column">'
            text += '<div class="n-c-wrap">앗! 아직 활동내역이 없습니다.<br>'
            text += '게시글을 등록하고 자유롭게 이야기를 나눠보세요!'
            text += `<button class="sendPage-btn" onclick="location.href='/community/community'">커뮤니티 입장하기</button>`
            text += '</div>'
            text += '</div>'
            $("#c-n").html(text);
            return;
        }

        boards.content.forEach(function (boardDTO) {
            var number = boardDTO.boardId;
            console.log("숫자"+number)
            text +='<div class="wraps">'
            text +="<div class='commu c-link "+boardDTO.boardId+"'>"
            text +='<input type="hidden" name="boId" value="'+number+'">'
            text +='<div class="c-top-wrap">'
            let date = new Date(boardDTO.createdDate);
            let year = date.getFullYear();
            let month = date.getMonth()+1;
            let day = date.getDate();
            let hour = date.getHours();
            let min = date.getMinutes();
            text +='<div class="c-date">'+year+"."+month+"."+day+" "+hour+":"+min+'</div>'
            text +="<a href='javascript:void(0);' onclick='removeCheck("+number+");' class='c-delete "+boardDTO.boardId+"'>삭제</a>"
            text +='</div>'
            text +='<div class="c-group">'
            text +='<div class="c-g-title">' + boardDTO.boardTitle + '</div>'
            text +='</div>'
            text +='<div class="commu-group">'
            text +='<span class="c-count">'
            text +='<svg data-v-bd9f2bcc="" data-v-7d0ae9c8="" width="16" height="16" viewBox="0 0 16 16" fill="black" xmlns="http://www.w3.org/2000/svg" class="mr-4 c-application c-icon" style="fill: rgb(148, 155, 160);"><path data-v-bd9f2bcc="" fill-rule="evenodd" clip-rule="evenodd" d="M13.8766 8C11.3452 12.6334 4.65478 12.6334 2.12331 8C4.65478 3.36658 11.3452 3.36658 13.8766 8ZM14.8923 7.78461C12.0525 2.10504 3.94746 2.10504 1.10767 7.78461C1.03988 7.9202 1.03988 8.07979 1.10767 8.21538C3.94746 13.895 12.0525 13.895 14.8923 8.21538C14.9601 8.07979 14.9601 7.9202 14.8923 7.78461Z"></path><path data-v-bd9f2bcc="" fill-rule="evenodd" clip-rule="evenodd" d="M8 9.5C8.82843 9.5 9.5 8.82843 9.5 8C9.5 7.17157 8.82843 6.5 8 6.5C7.17157 6.5 6.5 7.17157 6.5 8C6.5 8.82843 7.17157 9.5 8 9.5ZM8 10.5C9.38071 10.5 10.5 9.38071 10.5 8C10.5 6.61929 9.38071 5.5 8 5.5C6.61929 5.5 5.5 6.61929 5.5 8C5.5 9.38071 6.61929 10.5 8 10.5Z"></path></svg>'
            text +='<span class="c-text">' + boardDTO.boardViewCount + '</span>'
            text +='</span>'
            text +='<span class="c-count">'
            // text +='<svg data-v-bd9f2bcc="" data-v-7d0ae9c8="" width="16" height="16" viewBox="0 0 16 16" fill="black" xmlns="http://www.w3.org/2000/svg" class="mr-4 c-application c-icon" style="fill: rgb(148, 155, 160);"><path data-v-bd9f2bcc="" fill-rule="evenodd" clip-rule="evenodd" d="M3.69638 13.5299C4.05199 13.1404 4.04399 12.5417 3.67811 12.1619C2.63802 11.0821 2 9.6166 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8C14 11.3137 11.3137 14 8 14H3.26717L3.69638 13.5299ZM1 8C1 9.88557 1.74553 11.597 2.95789 12.8556L1.76434 14.1629C1.47131 14.4838 1.699 15 2.13358 15H8C11.866 15 15 11.866 15 8C15 4.13401 11.866 1 8 1C4.13401 1 1 4.13401 1 8Z"></path><path data-v-bd9f2bcc="" d="M6 8C6 8.41421 5.66421 8.75 5.25 8.75C4.83579 8.75 4.5 8.41421 4.5 8C4.5 7.58579 4.83579 7.25 5.25 7.25C5.66421 7.25 6 7.58579 6 8Z"></path><path data-v-bd9f2bcc="" d="M8.75 8C8.75 8.41421 8.41421 8.75 8 8.75C7.58579 8.75 7.25 8.41421 7.25 8C7.25 7.58579 7.58579 7.25 8 7.25C8.41421 7.25 8.75 7.58579 8.75 8Z"></path><path data-v-bd9f2bcc="" d="M11.5 8C11.5 8.41421 11.1642 8.75 10.75 8.75C10.3358 8.75 10 8.41421 10 8C10 7.58579 10.3358 7.25 10.75 7.25C11.1642 7.25 11.5 7.58579 11.5 8Z"></path></svg>'
            // text +='<span class="c-text">' + boardDTO.replyCount + '</span>'
            text +='</span>'
            text +='</div>'
            text +='</div>'
            text +='</div>'
        })
        $("div#c-w-wrap").html(text);

        showNewPage(boards.totalElements);
    }

    function showNewPage(totalElements){
        let endNumber = Math.ceil(globalThis.page / 5) * 5;
        let startNumber = endNumber - 4;
        let realEnd = Math.ceil(totalElements/ 10);

        if(endNumber > realEnd){
            endNumber = realEnd == 0 ? '1' : realEnd;
        }

        let prev = startNumber > 1;
        let next = endNumber < realEnd ;

        let text = "";

        text += '<ul>'
        text += '<li className="sidePageNum prev">'
        if(prev){
            text += `<a class="payPage" href="` + (startNumber - 1) + `"><svg width="16" height="16" class="sidePageDisabled" viewBox="0 0 16 16" fill="black" xmlns="http://www.w3.org/2000/svg" style="fill: #3c4144; margin-top: 4px; transform:rotate(270deg);" data-v-bd9f2bcc="" data-v-30c80689=""><path fill-rule="evenodd" clip-rule="evenodd" d="M7.64645 4.64645C7.84171 4.45118 8.15829 4.45118 8.35355 4.64645L12.8536 9.14645C13.0488 9.34171 13.0488 9.65829 12.8536 9.85355C12.6583 10.0488 12.3417 10.0488 12.1464 9.85355L8 5.70711L3.85355 9.85355C3.65829 10.0488 3.34171 10.0488 3.14645 9.85355C2.95118 9.65829 2.95118 9.34171 3.14645 9.14645L7.64645 4.64645Z" data-v-bd9f2bcc=""></path></svg></a></li>`
        }
        text += '<li>'
        for (let i=startNumber; i<=endNumber; i++){
            if(globalThis.page == i){
                text += `<code class="selectPage">` + i + `</code>`
                continue;
            }
            text += `<a class="payPage" href="`+ i + `"><code>` + i + `</code></a>`
        }
        text += '</li>'
        if(next){
            text += `<li class="sidePageNum next"><a class="payPage" href="` + (endNumber + 1) + `"><svg width="16" height="16" viewBox="0 0 16 16" fill="black" xmlns="http://www.w3.org/2000/svg" style="transform:rotate(90deg);" data-v-bd9f2bcc="" data-v-30c80689=""><path fill-rule="evenodd" clip-rule="evenodd" d="M7.64645 4.64645C7.84171 4.45118 8.15829 4.45118 8.35355 4.64645L12.8536 9.14645C13.0488 9.34171 13.0488 9.65829 12.8536 9.85355C12.6583 10.0488 12.3417 10.0488 12.1464 9.85355L8 5.70711L3.85355 9.85355C3.65829 10.0488 3.34171 10.0488 3.14645 9.85355C2.95118 9.65829 2.95118 9.34171 3.14645 9.14645L7.64645 4.64645Z" data-v-bd9f2bcc=""></path></svg></a></li>`
        }
        text += '</ul>'

        $("#paging").html(text);
    }

    $("div#paging").on("click", "a.payPage", function(e){
        console.log("들어옴?");
        e.preventDefault();
        globalThis.page = $(this).attr("href");
        showNew();
    });
</script>
</html>